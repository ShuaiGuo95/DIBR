# CPU版DIBR与深度图处理

## CPU版DIBR

DIBR.c

dibr.h

修改了之前内参使用的错误和一些已知bug

## 深度图生成与处理总体思路

- 将12台相机拍摄到的12路视频分为总帧数组，每组含有同步的12张纹理图；
  - 代码在splitdataset.py中
- 手动选定拍摄的比较好的一组，目前选的是人物在场景中心、且拍摄比较清晰的，然后用colmap估计这组纹理图对应的深度图、相机参数、深度尺度；
- 以该组相机参数、深度尺度去估计其他各组纹理图对应的深度图，得到粗糙深度图，这组参数和深度尺度也就是最终用在DIBR里的参数和深度尺度；
  - 代码在reconstruct.py中
- 为每台相机构建一张标准的场景背景深度图模板；
  - 先找到每台相机视角下不含有任何前景物体的标准背景纹理图模板；
  - 将含有前景信息的纹理图，与纹理图模板对比，根据RGB值的差异，把前景部分去掉，把背景部分的深度值累加起来；
  - 然后求背景上各点的深度值平均值；
  - 这部分代码在Denoise.cpp的bgmodel_process()函数，其中为了去掉前景，还加了很多经验参数，试错了很多次，所以代码很难复用。
- 以对应相机的标准场景背景模板，替换每组深度图中的背景部分，对于前景中的空洞，用距离比较近的非空洞值替换。
  - 这部分代码是Denoise.cpp里main()函数bgmodel_process()后面的部分。
